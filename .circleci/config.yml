version: 2.1
orbs:
  browser-tools: circleci/browser-tools@1.3.0
  python: circleci/python@2.0.3
commands:
  install-dependencies:
    steps:
      - python/install-packages:
          pip-dependency-file: requirement.txt
          pkg-manager: pip
  setup-browser:
    steps:
      - browser-tools/install-browser-tools:
          chrome-version: 105.0.5195.102
      - run:
          name: Verify Browser installation
          command: |
            google-chrome --version
            firefox --version
            geckodriver --version
            chromedriver --version

jobs:
  do-setup:
    docker:
      - image: cimg/python:3.10.5-browsers
    steps:
      - checkout
      - install-dependencies
      - setup-browser

  run-tests:
    docker:
      - image: cimg/python:3.10.5-browsers
    parameters:
      test-tag:
        type: string
    steps:
      - run:
          name: "Run the tests"
          no_output_timeout: 30m
          command: robot -d Results/<< parameters.test-tag >> -v env:prod -i << parameters.test-tag >> TGM/
      - store_artifacts:
          path: Results/<< parameters.test-tag >>
          destination: artifact-file

workflows:
  my-workflow:
    jobs:
      - do-setup
      - run-tests:
          matrix:
            parameters:
              test-tag: [billing_info, onboard, upgrade_plan, apply_theme]
          requires:
            - do-setup