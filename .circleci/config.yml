version: 2.1
setup: true
parameters:
  test-tag:
    type: string
    default: "apply_theme"
orbs:
  browser-tools: circleci/browser-tools@1.3.0
  python: circleci/python@2.0.3
#    |_ parameter name: (Specify a name the parameter)
#    |_ description: (Optional. Describes the parameter)
#    |_ type: (Required. datatype string, boolean, integer, enum)
#    |_ default: (The default value for the parameter)
  install-dependencies:
    steps:
      - python/install-packages:
          pip-dependency-file: requirement.txt
          pkg-manager: pip
  setup-browser:
    steps:
      - browser-tools/install-browser-tools:
          chrome-version: 103.0.5060.53
      - run:
          name: Verify Browser installation
          command: |
            google-chrome --version
            firefox --version
            geckodriver --version
            chromedriver --version
  run-tests:
    steps:
      - run:
          name: "Run Test Cases"
          command: |
              robot -d Results --output original.xml -v env:prod -i << pipeline.parameters.test-tag >> TGM/
  prepare-result:
      steps:
        - store_artifacts:
            path: Results
            destination: artifact-file
  run-test:
    circleci_ip_ranges: true
    docker:
      - image: cimg/python:3.10.5-browsers
    steps:
      - checkout
      - install-dependencies
      - setup-browser
      - run-tests
      - prepare-result

workflows:
  prepare-and-run-test:
    jobs:
      - run-test